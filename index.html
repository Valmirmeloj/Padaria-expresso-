<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padaria Express</title>
    
    <!-- Configura√ß√µes de Aplicativo Instal√°vel -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f97316">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3014/3014534.png">

    <!-- Bibliotecas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .card-destaque-slim { background: white; border-left: 5px solid #f97316; min-width: 260px; border-radius: 20px; padding: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 12px; scroll-snap-align: start; }
        .caixa-endereco-destaque { border: 3px dashed #f97316; background-color: #fff; position: relative; margin-top: 30px; border-radius: 30px; padding: 25px; box-shadow: 0 10px 25px rgba(249, 115, 22, 0.1); }
        .titulo-endereco-flutuante { position: absolute; top: -18px; left: 50%; transform: translateX(-50%); background-color: #ea580c; color: white; padding: 6px 25px; border-radius: 50px; font-weight: 900; font-size: 12px; text-transform: uppercase; white-space: nowrap; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .input-padrao { width: 100%; padding: 14px 14px 14px 50px; background-color: #f3f4f6; border-radius: 18px; font-weight: 700; outline: none; transition: 0.3s; border: 2px solid transparent; }
        .input-padrao:focus { border-color: #f97316; background-color: #fff; }
        .icone-input { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); z-index: 10; }
    </style>
</head>
<body class="bg-gray-50 pb-44">

    <header class="bg-white p-4 shadow-sm sticky top-0 z-50 border-b-2 border-orange-500 flex justify-between items-center px-6">
        <div>
            <h1 class="text-xl font-black text-orange-600 italic tracking-tighter uppercase">Padaria Express</h1>
            <p class="text-[9px] font-bold text-gray-400 uppercase tracking-widest text-center">Aberto</p>
        </div>
        <i class="fas fa-bread-slice text-orange-500 text-2xl"></i>
    </header>

    <main class="container mx-auto p-4">
        <!-- PRODUTOS EM DESTAQUE SLIM -->
        <section class="mb-8">
            <h2 class="text-[10px] font-black text-gray-400 uppercase mb-3 tracking-widest flex items-center gap-2">
                <i class="fas fa-bolt text-orange-500"></i> Sugest√µes R√°pidas
            </h2>
            <div id="container-destaques" class="flex overflow-x-auto gap-4 no-scrollbar pb-2">
                <!-- Preenchido pelo Firebase -->
            </div>
        </section>

        <!-- CARD√ÅPIO GERAL -->
        <section class="mb-10">
            <h2 class="text-[10px] font-black text-gray-400 uppercase mb-4 tracking-widest flex items-center gap-2">
                <i class="fas fa-th-large text-orange-500"></i> Card√°pio Completo
            </h2>
            <div id="container-geral" class="grid grid-cols-2 gap-4">
                <!-- Preenchido pelo Firebase -->
            </div>
        </section>

        <!-- ENDERE√áO FINAL -->
        <section class="mb-10">
            <div class="caixa-endereco-destaque shadow-xl">
                <div class="titulo-endereco-flutuante italic uppercase tracking-tighter">üè† Onde Entregar?</div>
                <div class="space-y-4 mt-2">
                    <div class="relative"><i class="fas fa-building icone-input text-orange-500"></i><input type="text" id="campo-condominio" placeholder="Nome do Condom√≠nio" class="input-padrao"></div>
                    <div class="flex gap-3">
                        <div class="relative w-1/2"><span class="icone-input font-black text-orange-500 text-xs uppercase">Bl</span><input type="text" id="campo-bloco" placeholder="Bloco" class="input-padrao pl-12"></div>
                        <div class="relative w-1/2"><i class="fas fa-door-open icone-input text-orange-500"></i><input type="text" id="campo-apto" placeholder="Apto" class="input-padrao"></div>
                    </div>
                    <div class="relative"><i class="fab fa-whatsapp icone-input text-green-500 text-xl"></i><input type="tel" id="campo-whatsapp" placeholder="Seu WhatsApp" class="input-padrao"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- BARRA DE FINALIZA√á√ÉO -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 shadow-2xl z-[60]">
        <button id="botao-enviar" class="w-full bg-green-600 text-white flex items-center justify-between p-5 rounded-[2.5rem] active:scale-95 transition-all shadow-lg">
            <div class="flex items-center gap-4">
                <div class="bg-white text-green-700 w-12 h-12 flex items-center justify-center rounded-full font-black text-2xl" id="contagem-itens">0</div>
                <div class="text-left font-black text-lg italic uppercase leading-none">Pedir Agora<br><span class="text-[9px] opacity-70 not-italic tracking-widest uppercase">Via WhatsApp</span></div>
            </div>
            <span id="preco-total" class="font-black text-2xl tracking-tighter">R$ 0,00</span>
        </button>
    </div>

    <script>
        // CONFIGURA√á√ÉO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyChLEeFcJ6Es4ADs79Bd9OkXAUCMskDsI4",
            authDomain: "padaria-expresso.firebaseapp.com",
            projectId: "padaria-expresso",
            storageBucket: "padaria-expresso.firebasestorage.app",
            messagingSenderId: "322600135014",
            appId: "1:322600135014:web:e9a88278e96984ca500a7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let carrinho = [];
        let produtosBD = [];

        window.onload = () => { 
            ouvirBanco(); 
            carregarDadosLocais(); 
            if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
        };

        // FUN√á√ÉO QUE L√ä O BANCO EM TEMPO REAL
        function ouvirBanco() {
            db.collection("produtos").orderBy("nome").onSnapshot(snapshot => {
                produtosBD = [];
                const dest = document.getElementById('container-destaques');
                const geral = document.getElementById('container-geral');
                dest.innerHTML = ''; geral.innerHTML = '';

                snapshot.forEach(doc => {
                    const p = doc.data();
                    const id = doc.id;
                    produtosBD.push({ id, ...p });

                    const card = `
                        <div class="${p.destaque ? 'card-destaque-slim' : 'bg-white rounded-[2rem] p-4 shadow-sm border border-gray-100 flex flex-col items-center text-center'}">
                            <img src="${p.img}" class="w-16 h-16 object-cover rounded-2xl shadow-sm">
                            <div class="flex-1 text-left px-2">
                                <h3 class="font-bold text-gray-800 text-[11px] leading-tight truncate">${p.nome}</h3>
                                <p class="text-orange-500 font-black text-xs">R$ ${Number(p.preco).toFixed(2)} <span class="text-[8px] text-gray-400">/${p.unid}</span></p>
                            </div>
                            <div class="flex items-center gap-2 bg-gray-100 rounded-xl p-1">
                                <button onclick="mudarQtd('${id}', -1)" class="bg-white w-7 h-7 rounded-lg text-orange-600 font-black shadow-sm">-</button>
                                <span id="q-${id}" class="font-black text-xs min-w-[15px]">0</span>
                                <button onclick="mudarQtd('${id}', 1)" class="bg-orange-500 w-7 h-7 rounded-lg text-white font-black shadow-sm">+</button>
                            </div>
                        </div>`;
                    
                    p.destaque ? dest.innerHTML += card : geral.innerHTML += card;
                });
                
                // Reaplica as quantidades se o banco atualizar
                carrinho.forEach(item => {
                    const el = document.querySelectorAll(`#q-${item.id}`);
                    el.forEach(span => span.innerText = item.qtd);
                });
            });
        }

        function mudarQtd(id, val) {
            let item = carrinho.find(i => i.id === id);
            if(item) {
                item.qtd += val;
                if(item.qtd <= 0) carrinho = carrinho.filter(i => i.id !== id);
            } else if(val > 0) {
                const p = produtosBD.find(prod => prod.id === id);
                carrinho.push({...p, qtd: 1});
            }
            
            // Atualiza visual
            const atual = carrinho.find(i => i.id === id);
            document.querySelectorAll(`#q-${id}`).forEach(el => el.innerText = atual ? atual.qtd : 0);
            
            // Calcula total
            const total = carrinho.reduce((a, b) => a + (Number(b.preco) * b.qtd), 0);
            const totalItens = carrinho.reduce((a, b) => a + b.qtd, 0);
            document.getElementById('preco-total').innerText = `R$ ${total.toFixed(2)}`;
            document.getElementById('contagem-itens').innerText = totalItens;
        }

        // Salva dados do cliente automaticamente
        document.querySelectorAll('input').forEach(input => {
            input.oninput = () => {
                const d = { 
                    c: document.getElementById('campo-condominio').value, 
                    b: document.getElementById('campo-bloco').value, 
                    a: document.getElementById('campo-apto').value, 
                    w: document.getElementById('campo-whatsapp').value 
                };
                localStorage.setItem('dados_venda', JSON.stringify(d));
            }
        });

        function carregarDadosLocais() {
            const s = JSON.parse(localStorage.getItem('dados_venda'));
            if(s) {
                document.getElementById('campo-condominio').value = s.c || '';
                document.getElementById('campo-bloco').value = s.b || '';
                document.getElementById('campo-apto').value = s.a || '';
                document.getElementById('campo-whatsapp').value = s.w || '';
            }
        }

        document.getElementById('botao-enviar').onclick = () => {
            const c = document.getElementById('campo-condominio').value;
            const a = document.getElementById('campo-apto').value;
            const w = document.getElementById('campo-whatsapp').value;
            
            if(carrinho.length === 0) return alert("Seu carrinho est√° vazio!");
            if(!c || !a) return alert("Preencha o condom√≠nio e o apartamento!");

            let m = `*PEDIDO PADARIA EXPRESS*\n`;
            m += `üè¢ *CONDOM√çNIO:* ${c.toUpperCase()}\n`;
            m += `üìç *LOCAL:* Bloco ${document.getElementById('campo-bloco').value} - Apto ${a}\n`;
            m += `üì± *WhatsApp:* ${w}\n`;
            m += `--------------------------\n`;
            carrinho.forEach(i => m += `‚úÖ ${i.qtd}x ${i.nome} - R$ ${(Number(i.preco) * i.qtd).toFixed(2)}\n`);
            m += `--------------------------\n`;
            m += `*TOTAL: ${document.getElementById('preco-total').innerText}*`;

            const telPadaria = "5511999999999"; // TROQUE PELO SEU N√öMERO
            window.open(`https://api.whatsapp.com/send?phone=${telPadaria}&text=${encodeURIComponent(m)}`);
        }
    </script>
</body>
</html>
